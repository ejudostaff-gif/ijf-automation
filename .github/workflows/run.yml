name: IJF Sheet Autofill (Flexible Columns)

on:
  workflow_dispatch:
    inputs:
      spreadsheet_url:
        description: "Google Sheets URL (https://docs.google.com/spreadsheets/d/....)"
        required: true
        type: string
      sheet_name:
        description: "Tab name (例: データベース). 空なら先頭タブ"
        required: false
        default: ""
        type: string

      # 範囲
      start_row:
        description: "Start row (例: 2)"
        required: false
        default: "2"
        type: string
      end_row:
        description: "End row (例: 5000)"
        required: false
        default: "1000"
        type: string

      # 列（ここが拡張ポイント）
      search_col:
        description: "検索に使う列（例: F）"
        required: false
        default: "F"
        type: string
      output_col:
        description: "書き込み先の列（例: Q）"
        required: false
        default: "Q"
        type: string

      # 実行制御
      batch_size:
        description: "Batch size per update (例: 100)"
        required: false
        default: "100"
        type: string
      sleep_sec:
        description: "Sleep seconds between queries (例: 0.8)"
        required: false
        default: "0.8"
        type: string

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Create credentials file
        run: |
          cat > credentials.json << 'EOF'
          ${{ secrets.GOOGLE_CREDENTIALS }}
          EOF

      - name: Run script
        run: python -u main.py
        env:
          GOOGLE_APPLICATION_CREDENTIALS: credentials.json
          PYTHONUNBUFFERED: "1"

          SPREADSHEET_URL: ${{ inputs.spreadsheet_url }}
          SHEET_NAME: ${{ inputs.sheet_name }}

          START_ROW: ${{ inputs.start_row }}
          END_ROW: ${{ inputs.end_row }}

          SEARCH_COL: ${{ inputs.search_col }}
          OUTPUT_COL: ${{ inputs.output_col }}

          BATCH_SIZE: ${{ inputs.batch_size }}
          SLEEP_SEC: ${{ inputs.sleep_sec }}
